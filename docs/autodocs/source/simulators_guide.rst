#####################################
Running Network Simulations with BMTK
#####################################


*************
Core Concepts
*************


Environment
===========

*How to Setup an environment for running simulations*

*Outline* 


Sonata Configuration files
==========================


"inputs"
^^^^^^^^

The "inputs" section of the SONATA config file is used to specify stimlus to apply to the network. It will contain one or more independent stimuli blocks
of the format 

.. code:: json 

    {
        "<BLOCK_NAME>": {
            "input_type": "<STIMULI_TYPE>",
            "module": "<STIMULI_FORMAT>",
            "node_set": "<NODES_SUBSET>",
            "param1": "<VAL1>",
            "param2": "<VAL2>",
            ...,
            "paramN": "value"

        }
    }

* The **<BLOCK_NAME>** is the name of the stimuli block, users can choose whatever name they want to identify a specific stimuli.
* **input_type** specifies the nature of the stimlulation, eg. if cell activity is being generated by synaptic events, current clamps, etc. The available options will depend of the resolution of the model and the type of cell models used. The options will depend on the input_type
* **module** is used to indicate the format of the stimuli. For example in trying to stimulate network with virtual spiking activity file, the individual spike times may be stored in a SONATA spikes file, a NWB file, a CSV, etc.
* **node_set** is a dictionary or reference used to select which cells to apply current stimuli to.
* Most stimuli will have one or more **parameters** options, depending on the input_type + module.





.. list-table::
   :widths: 25 25 50 20
   :header-rows: 1

   * - input_type
     - module
     - description
     - available
   * - current_clamp
     - | IClamp
       | csv
       | nwb 
       | allen
     - Directly injects current into one or more cells in the network. Shape of stimulus may be a simple block, or user may specify more advanced current form using a csv, nwb, or hdf5 file.
     - BioNet, PointNet
   * - spikes
     - | sonata
       | csv
       | ecephys_probe 
       | function
     - Reads a table of spike train events into one or more virtual cells in the network.
     - BioNet, PointNet
   * - voltage_clamp
     - SEClamp
     - Applys a voltage clamping block onto one or more cells.
     - BioNet
   * - extracellular
     - | xstim
       | comsol
     - Provides an extracellular potential to alter the membrane comptanence of a selected set of cells in the network. Can replicate extracellular stimulation coming from an electrode (xstim) or field can pre-generated (comsol). 
     - BioNet
   * - replay
     - replay
     - Allows users "replay" the recurrent activity of a previous recorded simulation with a selected subset of cells and/or connections. Useful for when looking at summative properties of contributions in large networks. 
     - BioNet, PointNet
   * - syn_activity
     - | syn_activity
       | function
       | list
     - Provides spontaneous firing of a select subset of recurrently connected synapses. Users may pre-specify firing times or let bmtk generate them randomly.  
     - BioNet
   * - movie
     - movie
     - Plays a movie (eg a numpy matrix file) onto the receptive field of a grid of neurons to mimic LGN reaction.
     - FilterNet
   * - movie
     - | grating
       | full_field_flash
       | spontaneous
       | looming
     - Automatically generate a movie of one of a number of well-known experimental stimuli and use it to play onto the receptive field of a set of neurons.
     - FilterNet


Runtime parameters
------------------



Executing the Simulation
========================




******************
Simulation Engines
******************



**************
Further Guides
**************



Starting Guides and Tutorials
=============================


.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  Simple Single Cell Biophysical Simulations will BioNet
        :link: builder_guide 
        :img-bottom: _static/images/ch2_simple_edge_swc_c_micron_scale__source_swc_red_target_swc_red.png

        *BioNet* 


    .. grid-item-card:: Complex Multi-cell, Cross Model Simulations
        :link: simulators_guide.rst
        :img-bottom: _static/images/l4-morpho-lifs-soma-tach.png

        *BioNet* 

       
    .. grid-item-card:: Large-scale simulation with Point-neuron LIF cells
        :link: analzer
        :img-bottom: _static/images/pointnet_figure.png

        *PointNet*

    .. grid-item-card:: Population-based firing rate model simulations
        :link: analzer
        :img-bottom: _static/images/dipde_figure.png

        *PopNet*


    .. grid-item-card:: Generating feedforward stimuli from Images and Movies
        :link: analzer
        :img-bottom: _static/images/lnp_model.jpg

        *FilterNet*

    .. grid-item-card:: Generating feedforward stimuli from Sound files
        :link: analzer
        :img-bottom: _static/images/spectrogram.jpeg

        *Auditory FilterNet*


Simulation Engines Key Concepts
===============================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  BioNet: Core Conecpts
        :link: builder_guide 


    .. grid-item-card::  BioNet: Core Conecpts
        :link: builder_guide 


    .. grid-item-card::  FilterNet: Core Conecpts
        :link: builder_guide 


Simulation Stimuli and Inputs
=============================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  Generating Custom spike inputs for simulation stimulus
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Loading Spikes from NWB 2.0 Files into BMTK simulations
        :link: builder_guide 
        
        *Something here*


    .. grid-item-card::  Using Allen Cell-Types database trials in a simulation
        :link: builder_guide 

        *Something here*


    .. grid-item-card::  Custom generated spike trains
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Advanced Options for Current clamp wave-forms in BioNet and PointNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Replaying recurrent activity in BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Generating Spontaneous Synaptic Activity in BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Using Movies in FilterNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Autogenerated Movies in FilterNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Auditory Stimuli for FilterNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Auditory Stimuli for FilterNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Extracellular Stimulation of Networks in BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Importing Experimental Sweep data from the Allen Cell-Types Database
        :link: builder_guide 
        
        *Something here*



Simulation Variables and Reports
================================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  Recording Local Field Potentials and Current Source Densities in BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Recording Synaptic weights and properties
        :link: builder_guide 
        
        *Something here*


    .. grid-item-card::  Membrane-Recording in BioNet
        :link: builder_guide 

        *Something here*


    .. grid-item-card::  Membrane-Recording in PointNet
        :link: builder_guide 
        
        *Something here*


Running and Computing
=====================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  Optimization Techniques in FilterNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Help with installing and running BioNet and PointNet on HPC
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Running BMTK on Neuroscience Gateway (NSG)
        :link: builder_guide 
        
        *Something here*


Custom and Imported Models
==========================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card::  Importing ModelDB and OpenSourceBrain cell models into BioNet simulations.
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Building your own cell models in BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Importing custom membrane mechanics into your models for BioNet
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card::  Dynamically modfying cell properties before and during simulation.
        :link: builder_guide 
        
        *Something here*

    .. grid-item-card:: Creating and importing custom models using NESTML for PointNet
        :link: builder_guide 
        
        *Something here*


Advanced Programming Options
============================

.. grid:: 1 1 4 4
    :gutter: 1

    .. grid-item-card:: Creating Customized Modules
        :link: builder_guide 
        
        *Something here*